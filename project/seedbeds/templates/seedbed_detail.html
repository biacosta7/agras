{% extends "base.html" %} 
{% load static %}

{% block title %}{{ seedbed.nome }}{% endblock %}

{% block content %}
<!-- Main content -->
 <div class="flex-1 p-6 fade-down lg:p-10 ml:0 lg:ml-[250px] mt-12 lg:mt-[60px]">


     <div class="flex justify-between items-center">
         <h2 class="ml-5 mt-2 text-4xl font-bold">{{ seedbed.nome }}</h2>
     </div>
     
     <br>
     
     <div class="container mx-auto mt-5">
         <div class="flex items-center justify-center">
             <div class="text-center flex-1">
                 <ul class="flex flex-wrap list-none justify-center">
                     {% for product in seedbed.products_in_seedbed.all %}
                         <li class="flex flex-col items-center mr-12 mb-4">
                             <a href="?product_id={{ product.id }}">
                                 <img src="{% static 'assets/small-plant.png' %}" alt="Área de plantio" class="w-16 h-16 mb-1">
                                 <p class="text-lg">{{ product.type_product.name }}</p>
                             </a>
                         </li>
                     {% empty %}
                         <li>Nenhum cultivo cadastrado</li>
                     {% endfor %}
                     <li class="flex flex-col items-center mb-4 mr-12">  
                         <a href="{% url 'create_product' community.id area.pk seedbed.id %}">
                             <img src="{% static 'assets/add.png' %}" alt="Adicionar novo cultivo" class="w-16 h-16">
                         </a>
                         <p class="text-lg">Adicionar Cultivo</p>
                     </li>
                 </ul>
             </div>
         </div>
     </div>
     <br>
     {% if seedbed.products_in_seedbed.all %}
     <div class="flex items-center justify-center"> 
         <div class="bg-[#fafafa] p-6 rounded-lg shadow-lg" style="max-width: 1200px; width: 90%; height: 450px; overflow: auto;">
             <!-- Dropdown para selecionar produto -->
             <form method="GET" action="">
                 <div class="flex items-center">
                     <div class="flex-container">
                         <select id="product-select" name="product_id" class="mb-4 p-2 border border-gray-300 rounded">
                             <option value="">Selecione um cultivo</option>
                             {% for product in products %}
                                 <option value="{{ product.id }}" {% if selected_product and selected_product.id == product.id %}selected{% endif %}>
                                     {{ product.type_product.name }}
                                 </option>
                             {% endfor %}
                         </select>
                         <button type="submit" class="bg-[#8ABF17] text-white py-2 px-4 rounded hover:bg-[#5F8C1B] transition duration-200 ml-4">
                             Ver Detalhes
                         </button>
                     </div>
                 </div>
             </form>
             
             <!-- Detalhes do produto selecionado -->
             {% if selected_product %}
             <div class="product-info mt-6">
                 <div class="left-info mb-4">
                     <p>
                         <span class="text-lg font-semibold mr-12">Data de plantio:</span>
                         <span class="text-lg" id="planting-date">{{ selected_product.data_plantio }}</span>
                     </p>
                     <br>
                     <p>
                         <span class="text-lg font-semibold mr-4">Estimativa de colheita:</span> 
                         <span class="text-lg" id="harvest-estimate">2 de Janeiro de 2025</span>
                     </p>
                     <br>
                     <span class="text-lg font-semibold mr-12">Tarefas:</span>
                     <div id="to-do-list">
                         <ul class="list-disc ml-5">
                             <li>Regar</li>
                             <li>Fertilizar</li>
                         </ul>
                     </div>
                     <p>
                         <a href="#" id="read-more" onclick="toggleToDo()" 
                         class="mt-3 ml-1 text-[#5F8C1B] font-semibold hover:text-[#8ABF17] transition duration-200 inline-block">
                             Ler mais
                         </a>
                     </p>
                 </div>
         
                 <div class="right-info">
                     <p>
                         <span class="text-lg font-semibold mr-2">Quantidade: </span>
                         <span class="text-lg" id="quantidade">{{ selected_product.quantidade }}</span>
                     </p>
                     <br>
                     <p>
                         <span class="text-lg font-semibold mr-2">Produção esperada: </span>
                         <span class="text-lg" id="expected-production">100</span>
                     </p>
                     <br>
                     <p> 
                         <span class="text-lg font-semibold mr-2">Comentários: </span>
                         <br>
                         <span class="ml-1 text-base" id="comments">Em breve...</span>
                     </p>
                     <br>
                     <form id="delete-product-form" method="POST" action="{% url 'product_delete' community.id area.id seedbed.id selected_product.id %}" style="display:none;">
                         {% csrf_token %}
                     </form>
                     <button type="button" class="mt-5 m-2 bg-[#F77711] p-7 text-white py-2 rounded hover:bg-[#F76711] transition duration-200" onclick="openModal()">Excluir</button>
                     <button type="button" class="mt-5 m-2 bg-[#562A00] p-7 text-white py-2 rounded hover:bg-[#401F00] transition duration-200" onclick="openEditModal()">
                         Editar
                     </button>
                 </div>
             </div>
             {% endif %}
         
             <!-- Modal de Confirmação de Exclusão -->
             <div id="deleteModal" class="modal">
                 <div class="modal-content">
                     <span class="close cursor-pointer" onclick="closeModal()">&times;</span>
                     <h1 class="mt-2 font-bold">Tem certeza que deseja excluir o cultivo "{{ selected_product.type_product.name }}"?</h1>
                     <p class="mt-2">Essa ação não pode ser desfeita.</p>
                     <br>
                     <button class="bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700 transition duration-200" onclick="document.getElementById('delete-product-form').submit();">Excluir</button>
                     <button class="bg-gray-300 text-black py-2 px-4 rounded hover:bg-gray-400 transition duration-200" onclick="closeModal()">Cancelar</button>
                 </div>
             </div>
             <!-- Modal de Edição -->
             <div id="editModal" class="modal">
                 <div class="modal-content">
                     <span class="close cursor-pointer" onclick="closeEditModal()">&times;</span>
                     <h1 class="mt-2 font-bold">Editar Cultivo "{{ selected_product.type_product.name }}"</h1>
     
                    <!-- Formulário de Edição -->
                     <form id="edit-product-form" method="POST" action="{% url 'product_update' community.id area.id seedbed.id selected_product.id %}">
                         {% csrf_token %}
                         
                         <!-- Campo para editar quantidade -->
                         <div class="mt-4">
                             <label for="edit-quantidade" class="block font-semibold">Quantidade:</label>
                             <input type="number" id="edit-quantidade" name="quantidade" class="w-full border border-gray-300 p-2 rounded" 
                                 value="{{ selected_product.quantidade }}" required>
                         </div>
     
                         <!-- Campo para editar data de plantio -->
                         <div class="mt-4">
                             <label for="edit-data-plantio" class="block font-semibold">Data de Plantio:</label>
                             <input type="date" id="edit-data-plantio" name="data_plantio" class="w-full border border-gray-300 p-2 rounded" 
                                 value="{{ selected_product.data_plantio|date:'Y-m-d' }}" required>
                         </div>
     
                         <!-- Botões de ação -->
                         <div class="mt-6 flex justify-end">
                             <button type="button" class="bg-gray-300 text-black py-2 px-4 rounded hover:bg-gray-400 transition duration-200 mr-2" onclick="closeEditModal()">Cancelar</button>
                             <button type="submit" class="bg-[#8ABF17] text-white py-2 px-4 rounded hover:bg-[#5F8C1B] transition duration-200">Salvar Alterações</button>
                         </div>
                     </form>
     
                 </div>
             </div>
     
         </div>
     </div>
     {% endif %}
 </div>

<script>
    function openModal() {
        document.getElementById('deleteModal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('deleteModal').style.display = 'none';
    }

    // Fechar o modal ao clicar fora dele
    window.onclick = function(event) {
        const modal = document.getElementById('deleteModal');
        if (event.target === modal) {
            closeModal();
        }
    }
    //modal de edit
    function openEditModal() {
        document.getElementById('editModal').style.display = 'block';
    }

    function closeEditModal() {
        document.getElementById('editModal').style.display = 'none';
    }

    // Fechar o modal ao clicar fora dele
    window.onclick = function(event) {
        const editModal = document.getElementById('editModal');
        if (event.target === editModal) {
            closeEditModal();
        }
    }
</script>

{% endblock content %}
